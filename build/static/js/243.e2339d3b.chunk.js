"use strict";(self.webpackChunksound_engine=self.webpackChunksound_engine||[]).push([[243],{243:(t,e,n)=>{n.d(e,{default:()=>_});const s=class{constructor(t,e){const n=new t.Volume(0);e.connect(n),n.toDestination()}};class o{constructor(t,e,n){this.name=t,this.sampleMap=e,this.type=n,this.buffers=null,this.notes=null,this.loopLength=null,this.timingRange=null,this.velocityRange=null,this.skipChance=null,this.noteChance=null,this.attack=null,this.release=null,this.fxLevel=null,this.db=null}updateBuffers(t){this.buffers=t}}o.TYPE_BG_LOOP=1,o.TYPE_STANDARD=2;class i{constructor(t,e,n){this.tone=t,this.id=e,this.name=n,this.buffers=null,this.instruments=[]}async load(){if(this.buffers)return console.log("Song: Load already complete"),!0;console.log("Song: Load URLs from",this.instruments.length,"instruments");const t={};this.instruments.forEach((e=>{const n=e.sampleMap;Object.entries(n).forEach((n=>{let[s,o]=n;const i=`${e.name}_${s}`,a=`/dev/hyatt/sounds/${o}`;t[i]=a}))})),this.buffers=new this.tone.Buffers(t);try{return await this.tone.loaded(),this.instruments.forEach((t=>{const e=Array.from(this.buffers._buffers.keys()).filter((e=>e.startsWith(t.name+"_"))).map((e=>({note:e.substring(t.name.length+1),buffer:this.buffers.get(e)})));t.updateBuffers(e)})),console.log("Song: Load complete:",this.instruments.length,"instruments"),!0}catch(e){return console.error("Song: Error loading buffers:",e),!1}}getInstrumentByName(t){return this.instruments.find((e=>e.name===t))}getBackgroundLoop(){return this.instruments.filter((t=>t.type===o.TYPE_BG_LOOP))[0]}getInstruments(){return this.instruments.filter((t=>t.type===o.TYPE_STANDARD))}getRandomInstrument(){const t=this.getInstruments();return t[Math.floor(Math.random()*t.length)]}}i.NAME_INTRO="Intro",i.NAME_DELTA="Delta",i.NAME_THETA="Theta",i.NAME_ALPHA="Alpha",i.NAME_BETA="Beta",i.NAME_GAMMA="Gamma";class a extends i{constructor(t,e){super(t,e,i.NAME_INTRO);const n=new o("introBgLoop",{C3:"intro/i_reverb_bed.mp3"},o.TYPE_BG_LOOP);n.notes=[{time:"0",pitch:"C3"}],n.loopLength=12,n.loopTotal=-1,n.db=-17,this.instruments.push(n);const s=new o("introGuzheng",{C3:"intro/i_guzheng_note.mp3"},o.TYPE_STANDARD);s.notes=[{time:"0",pitch:"C2",velocity:.6},{time:"6m",pitch:"C3",velocity:.35}],s.loopLength="12m",s.loopTotal=1,s.timingRange=.6,s.velocityRange=.4,s.skipChance=.45,s.noteChance=0,s.db=-2,this.instruments.push(s);const a=new o("thetaBass",{C3:"theta/t_bass_atm.mp3"},o.TYPE_STANDARD);a.notes=[{time:"0",pitch:"C3",velocity:1}],a.loopLength="12m",a.loopTotal=1,a.velocityRange=.4,a.skipChance=.1,a.db=-4,this.instruments.push(a);const l=new o("introShimmerBg",{C3:"intro/i_shimmer_bg.mp3"},o.TYPE_STANDARD);l.notes=[{time:"1m",pitch:"C3",velocity:.5}],l.loopLength="9m",l.loopTotal=1,l.velocityRange=.5,a.skipChance=.5,l.db=-21,this.instruments.push(l)}}class l extends i{constructor(t,e){super(t,e,i.NAME_DELTA);const n=new o("deltaBgLoop",{C3:"delta/d_reverb_bed.mp3"},o.TYPE_BG_LOOP);n.notes=[{time:"0",pitch:"C3"}],n.loopLength=21,n.loopTotal=-1,n.db=-10,this.instruments.push(n);const s=new o("deltaSubBassNote",{C3:"delta/d_sub_bass_note.mp3"},o.TYPE_STANDARD);s.notes=[{time:"0",pitch:"C4",velocity:.4},{time:"6m",pitch:"A3",velocity:.4},{time:"11m",pitch:"C3",velocity:.4}],s.loopLength="16m",s.loopTotal=1,s.timingRange=.6,s.velocityRange=.1,s.noteChance=.6,s.skipChance=.6,s.db=-10,this.instruments.push(s);const a=new o("deltaAmbientTinesNote",{C3:"delta/d_ambient_tines_note.mp3"},o.TYPE_STANDARD);a.notes=[{time:"0",pitch:"C3",velocity:.65},{time:"5m",pitch:"C2",velocity:.65}],a.loopLength="14m",a.loopTotal=1,a.timingRange=.6,a.velocityRange=.2,a.noteChance=.6,a.skipChance=.7,a.db=-6,this.instruments.push(a)}}class h extends i{constructor(t,e){super(t,e,i.NAME_THETA);const n=new o("thetaBgLoop",{C3:"theta/t_bg_loop.mp3"},o.TYPE_BG_LOOP);n.notes=[{time:"0",pitch:"C3"}],n.loopLength="7m",n.loopTotal=-1,n.db=-10,this.instruments.push(n);const s=new o("thetaBass",{C3:"theta/t_bass_atm.mp3"},o.TYPE_STANDARD);s.notes=[{time:"0",pitch:"G3",velocity:.75},{time:"5m",pitch:"C4",velocity:.65},{time:"10m",pitch:"C3",velocity:.9}],s.loopLength="18m",s.loopTotal=1,s.velocityRange=.35,s.skipChance=.3,s.db=0,this.instruments.push(s);const a=new o("thetaBellNote",{C3:"theta/t_bell_note.mp3"},o.TYPE_STANDARD);a.notes=[{time:"0",pitch:"C3"}],a.loopLength="8m",a.loopTotal=1,a.timingRange=.6,a.velocityRange=.4,a.skipChance=.45,a.db=-6,this.instruments.push(a);const l=new o("thetaChimesNote",{C3:"theta/t_chimes_note.mp3"},o.TYPE_STANDARD);l.notes=[{time:"0",pitch:"G3",velocity:.7},{time:"5m",pitch:"C4",velocity:.45},{time:"8m",pitch:"C3",velocity:1}],l.loopLength="29m",l.loopTotal=1,l.timingRange=.6,l.velocityRange=.4,l.skipChance=.3,l.db=-3,this.instruments.push(l);const h=new o("thetaChimesBg",{C3:"theta/t_chimes_bg.mp3"},o.TYPE_STANDARD);h.notes=[{time:"0",pitch:"C4",velocity:.3},{time:"5m",pitch:"C3",velocity:1}],h.loopLength="14m",h.loopTotal=1,h.velocityRange=.3,h.skipChance=.3,h.db=0,this.instruments.push(h)}}class r extends i{constructor(t,e){super(t,e,i.NAME_ALPHA);const n=new o("alphaBgLoop",{C3:"alpha/a_reverb_bed.mp3"},o.TYPE_BG_LOOP);n.notes=[{time:"0",pitch:"C3"}],n.loopLength=22,n.loopTotal=-1,n.db=-14,this.instruments.push(n);const s=new o("alphaMindfullnessPad",{C3:"alpha/a_mindfullness_padR.mp3"},o.TYPE_STANDARD);s.notes=[{time:"0:0:0",pitch:["C3","E3","G3","B2"],velocity:.7},{time:"6m",pitch:["D3","F3","A2","C3"],velocity:.7},{time:"12m",pitch:["E2","G2","B2","D3"],velocity:.7},{time:"18m",pitch:["F3","A2","C3","E2"],velocity:.7},{time:"24m",pitch:["G2","B2","D3","E2"],velocity:.7},{time:"30m",pitch:["A2","C3","E3","G2"],velocity:.7}],s.loopLength="36m",s.loopTotal=1,s.timingRange=.3,s.velocityRange=.2,s.skipChance=.25,s.noteChance=.95,s.db=-17,this.instruments.push(s);const a=new o("alphaSoftKey",{C3:"alpha/a_soft_key.mp3"},o.TYPE_STANDARD);a.notes=[{time:"0:0:0",pitch:"C2"},{time:"0:4:0",pitch:"D2"},{time:"2:0:0",pitch:"E2"},{time:"2:4:0",pitch:"G2"},{time:"4:0:0",pitch:"A2"},{time:"4:4:0",pitch:"C3"},{time:"6:0:0",pitch:"D3"}],a.loopLength="6:3:0",a.loopTotal=1,a.timingRange=.6,a.velocityRange=.2,a.skipChance=.75,a.noteChance=.9,a.db=-30,this.instruments.push(a);const l=new o("alphaLoundBell",{C3:"alpha/a_lound_note.mp3"},o.TYPE_STANDARD);l.notes=[{time:"0:3:0",pitch:"C2"},{time:"1:1:0",pitch:"D2"},{time:"3:2:0",pitch:"G2"},{time:"4:2:0",pitch:"A2"}],l.loopLength="6m",l.loopTotal=1,l.timingRange=.4,l.velocityRange=.3,l.skipChance=.35,l.noteChance=.9,l.db=-30,this.instruments.push(l);const h=new o("alphaJvAnalogPad",{C3:"alpha/a_JV_analog_padR.mp3"},o.TYPE_STANDARD);h.notes=[{time:"0",pitch:["C3","E3","G3","B3"],velocity:.7},{time:"5m",pitch:["D3","F3","A3","C4"],velocity:.7},{time:"10m",pitch:["E3","G3","B3","D4"],velocity:.7},{time:"15m",pitch:["F3","A3","C4","E4"],velocity:.7},{time:"20m",pitch:["G3","B3","D4","E4"],velocity:.7},{time:"25m",pitch:["A3","C4","E4","G4"],velocity:.7}],h.loopLength="30m",h.loopTotal=1,h.timingRange=.3,h.velocityRange=.35,h.skipChance=.35,h.noteChance=.95,h.db=-24,this.instruments.push(h);const r=new o("alphaDreamBg",{C3:"alpha/a_dream_bg.mp3"},o.TYPE_STANDARD);r.notes=[{time:"0",pitch:"C3",velocity:.8}],r.loopLength="7m",r.loopTotal=1,r.velocityRange=.25,r.db=-12,this.instruments.push(r);const p=new o("alphaTangerineBg",{C3:"alpha/a_tangerine_bg.mp3"},o.TYPE_STANDARD);p.notes=[{time:"0",pitch:"C3",velocity:.5},{time:"7m",pitch:"C2",velocity:.75}],p.loopLength="19m",p.loopTotal=1,p.skipChance=.3,p.db=-5,this.instruments.push(p);const c=new o("betaHarpBg",{C3:"beta/b_harp_bg.mp3"},o.TYPE_STANDARD);c.notes=[{time:"0",pitch:"C2"}],c.loopLength="12m",c.loopTotal=1,c.db=-22,this.instruments.push(c)}}class p extends i{constructor(t,e){super(t,e,i.NAME_BETA);const n=new o("betaBeats",{C0:"beta/b_beat_1.mp3",C1:"beta/b_beat_2.mp3",C2:"beta/b_beat_3.mp3",C3:"beta/b_beat_4.mp3",C4:"beta/b_beat_5.mp3",C5:"beta/b_beat_6.mp3"},o.TYPE_BG_LOOP);n.notes=[{time:"0:0:0",pitch:"C0"},{time:"16m",pitch:"C1"},{time:"32m",pitch:"C2"},{time:"48m",pitch:"C3"},{time:"64m",pitch:"C4"},{time:"80m",pitch:"C5"}],n.loopLength="96m",n.loopTotal=-1,n.noteChance=.99,n.db=-2,this.instruments.push(n);const s=new o("betaAtm",{C3:"beta/b_bg_loop.mp3"},o.TYPE_STANDARD);s.notes=[{time:"0",pitch:"C3"}],s.loopLength=22,s.loopTotal=-1,s.db=-16,this.instruments.push(s);const a=new o("betaHarpNote",{C3:"beta/b_harp_note.mp3"},o.TYPE_STANDARD);a.notes=[{time:"0:3:0",pitch:["C2","G1"],velocity:.8},{time:"3:3:0",pitch:["G2","C2"],velocity:.8},{time:"6:1:0",pitch:["C3","G2"],velocity:.8},{time:"8:3:0",pitch:["C2","G1"],velocity:.8},{time:"10:3:0",pitch:["E2","C3"],velocity:.8}],a.loopLength="12m",a.loopTotal=1,a.timingRange=.4,a.velocityRange=.3,a.skipChance=.4,a.noteChance=.75,a.db=-22,this.instruments.push(a);const l=new o("betaHarpBg",{C3:"beta/b_harp_bg.mp3"},o.TYPE_STANDARD);l.notes=[{time:"0",pitch:"C3"}],l.loopLength="6m",l.loopTotal=1,l.db=-20,this.instruments.push(l);const h=new o("betaBellsBg",{C3:"beta/b_bells_bg.mp3"},o.TYPE_STANDARD);h.notes=[{time:"0",pitch:"C3"}],h.loopLength="11m",h.loopTotal=1,h.db=-29,this.instruments.push(h);const r=new o("betaDriftBg",{C3:"beta/b_drift_bg.mp3"},o.TYPE_STANDARD);r.notes=[{time:"0",pitch:"C2",velocity:.75},{time:"4m",pitch:"C4",velocity:.15},{time:"9m",pitch:"C3",velocity:.5}],r.timingRange=.6,r.loopLength="17m",r.loopTotal=1,r.velocityRange=.15,r.skipChance=.5,r.db=-20,this.instruments.push(r);const p=new o("betaDreamBg",{C3:"beta/b_dream_bg.mp3"},o.TYPE_STANDARD);p.notes=[{time:"0",pitch:"C4",velocity:.2},{time:"3m",pitch:"C3",velocity:.6}],p.loopLength="9m",p.loopTotal=1,p.skipChance=.5,p.db=-9,this.instruments.push(p)}}class c extends i{constructor(t,e){super(t,e,i.NAME_GAMMA);const n=new o("gammaBgLoop",{C3:"gamma/g_reverb_bed.mp3"},o.TYPE_BG_LOOP);n.notes=[{time:"0",pitch:"C3"}],n.loopLength=19,n.loopTotal=-1,n.db=-17,this.instruments.push(n);const s=new o("gammaChakraArp",{C3:"gamma/g_chakra_arp.mp3"},o.TYPE_STANDARD);s.notes=[{time:"0",pitch:"C3",velocity:1},{time:"9m",pitch:"G3",velocity:.85},{time:"15m",pitch:"C4",velocity:.325},{time:"18m",pitch:"C2",velocity:.8}],s.loopLength="32m",s.loopTotal=1,s.timingRange=0,s.velocityRange=.2,s.skipChance=.4,s.db=-10,this.instruments.push(s);const a=new o("gammaSpinningWheel",{C3:"gamma/g_spinning_wheel.mp3"},o.TYPE_STANDARD);a.notes=[{time:"0",pitch:"C3",velocity:1},{time:"10m",pitch:"C4",velocity:.25}],a.loopLength="12m",a.loopTotal=1,a.velocityRange=.125,a.skipChance=.4,a.db=-3,this.instruments.push(a);const l=new o("gammaBell",{C3:"gamma/g_bell_note.mp3"},o.TYPE_STANDARD);l.notes=[{time:"0:0:0",pitch:"C0",velocity:.8},{time:"0:1:0",pitch:"F0",velocity:.8},{time:"0:2:0",pitch:"G0",velocity:.8},{time:"2:0:0",pitch:"C1",velocity:.8},{time:"2:1:0",pitch:"F1",velocity:.8},{time:"2:2:0",pitch:"G1",velocity:.7},{time:"4:0:0",pitch:"C2",velocity:.6},{time:"4:1:0",pitch:"F2",velocity:.5},{time:"4:2:0",pitch:"G2",velocity:.35}],l.loopLength="6m",l.loopTotal=1,l.velocityRange=.15,l.skipChance=.45,l.db=-10,this.instruments.push(l);const h=new o("gammaCrystalSparkle",{C3:"gamma/g_crystal_sparkle.mp3"},o.TYPE_STANDARD);h.notes=[{time:"0",pitch:"C1",velocity:.9},{time:"2m",pitch:"G1",velocity:.7},{time:"4m",pitch:"C2",velocity:.3},{time:"6m",pitch:"G1",velocity:.6}],h.loopLength="8m",h.loopTotal=1,h.velocityRange=.2,h.skipChance=.4,h.db=-10,this.instruments.push(h);const r=new o("gammaCrystalPad",{C3:"gamma/g_crystal_bg.mp3"},o.TYPE_STANDARD);r.notes=[{time:"0",pitch:"C3",velocity:1},{time:"4m",pitch:"G3",velocity:.45},{time:"8m",pitch:"F2",velocity:.6}],r.loopLength="12m",r.loopTotal=1,r.velocityRange=.15,r.skipChance=.5,r.db=-15,this.instruments.push(r);const p=new o("gammaChoirPad",{C3:"gamma/g_jv_warm_choir_pad.mp3"},o.TYPE_STANDARD);p.notes=[{time:"0",pitch:"G3",velocity:.9}],p.loopLength="4m",p.loopTotal=1,p.velocityRange=.2,p.skipChance=.3,p.db=-9,this.instruments.push(p)}}class m{constructor(t,e,n,s){this.tone=t,this.id=e,this.mainOutput=n,this.onComplete=s,this.instrumentName=null,this.instrumentType=null;const o="/dev/hyatt/sounds/global/z_test_tone.mp3";this.player=new this.tone.Sampler({urls:{C1:o,C2:o,C3:o,C4:o,C5:o,C6:o,C7:o,C8:o},attack:0}),this.player.connect(n),this.stop=this.stop.bind(this),this.part=null,this.onCompleteID=null,this.sixteenthSeconds=this.tone.Time("16n").toSeconds()}playInstrument(t){if(!this._checkInstrumentName(t.name))return;console.log(""),console.log("//////////////////////////////"),console.log("PLYR",this.id,"Queued to play",t.name),this.instrumentType=t.type;if(!this._loadBuffers(t.buffers))return void console.warn("PLYR",this.id,": Error loading buffer.");const e=t.notes,n=t.loopLength,s=t.loopTotal;let i=t.timingRange;i||(i=0);let a=t.velocityRange;a||(a=0);let l=t.skipChance;l||(l=0);let h=t.noteChance;h||(h=0);const r=t.db;t.type===o.TYPE_BG_LOOP?this.player.volume.rampTo(r,10):this.player.volume.rampTo(r,3);let p=[];if(h>0&&(p=[...new Set(e.map((t=>t.pitch)))]),this.part&&this.part.dispose(),this.part=new this.tone.Part(((t,e)=>{let n=1;n=Math.random()<l?0:0===a?1:Math.random()*a+(1-a);const s=e.velocity||1;let o=t;if(0!==i){const e=(Math.random()*(2*i)-i)*this.sixteenthSeconds;o=Math.max(t+e,0)}h>0&&p.length>0&&Math.random()<h&&(e.pitch=p[Math.floor(Math.random()*p.length)]),s*n===0?console.log("---------------- PLYR",this.id,this.instrumentName,"SKIPPED"):(console.log("++++++++++++++++ PLYR",this.id,this.instrumentName,"note at",o,"w/pitch",e.pitch,"& velo",s*n),this.player.triggerAttack(e.pitch,o,s*n))}),e),0===s)return void console.error("PLYR",this.id,this.instrumentName,": Error: loopTotal is 0. This will not play. Use -1 to loop forever, 1 for single play, and 2 and above for multiple plays.");(-1===s||s>1)&&(this.part.loop=!0,this.part.loopEnd=n);const c=e[0],m=this.tone.Time(c.time).toSeconds(),u=this.tone.now()+m+2.4;if(s>0){const t=u+this.tone.Time(n).toSeconds();this.onCompleteID=this.tone.getTransport().scheduleOnce((t=>{console.log("PLYR ----------------\x3e>>> ",this.id,this.instrumentName,"onComplete at",t),this.onComplete&&this.onComplete(this.instrumentName,this.instrumentType)}),t)}this.part.start(u),"started"!==this.tone.getTransport().state&&(console.log("PLYR",this.id,": Transport not started, starting now."),this.tone.getTransport().start())}stop(){this.part&&this.part.stop(),this.tone.getTransport().clear(this.onCompleteID),this.onCompleteID=null,this.instrumentName=null,this.instrumentType=null}getInstrumentName(){return this.instrumentName}resetInstrument(){this.instrumentName=null,this.instrumentType=null}_checkInstrumentName(t){return this.instrumentName?(console.warn("PLYR",this.id,": Already playing",this.instrumentName),!1):(this.instrumentName=t,!0)}_loadBuffers(t){try{if(!this.player)return console.error("PLYR: this.player is not initialized"),!1;if(!t)return console.warn("PLYR: _loadBuffers: newBuffers is not defined."),!1;if(1===t.length){const e=t[0],n=e.note,s=e.buffer?e.buffer._buffer:e._buffer;return s&&n?(this.player._buffers._buffers.clear(),this.player.add(n,s),!0):(console.warn("PLYR: _loadBuffers: The single entry is missing a note or buffer.",e),!1)}return t.forEach((t=>{const e=t.note,n=t.buffer;e&&n&&n._buffer?this.player.add(e,n._buffer):console.warn("PLYR: _loadBuffers: Missing note or buffer in entry:",t)})),!0}catch(e){return console.error("PLYR: Error updating buffers in _loadBuffers:",e),!1}}}class u{constructor(t,e){this.osc=new t.Oscillator(523.25,"sine"),this.osc.volume.value=-30,this.ampEnv=new t.AmplitudeEnvelope({attack:3.5,decay:1,sustain:.9,release:"8m"}),this.autoPan=new t.AutoPanner(5,1),this.osc.connect(this.ampEnv),this.ampEnv.connect(this.autoPan),this.autoPan.connect(e),this.frequencies=[392,164.81,392,523.25,783.99,1046.5]}setFrequency(t){this.autoPan.frequency.value=t}start(){this.autoPan.start(),this.osc.start()}play(t){this.osc.frequency.value=this.frequencies[t],this.ampEnv.triggerAttackRelease("2m")}}class g{constructor(t,e,n){this.tone=t,this.players=[new m(t,0,e,n),new m(t,1,e,n),new m(t,2,e,n),new m(t,3,e,n)],this.solfeggioSynth=new u(t,e),this.activeInstrumentNames=[],this.bgLoopID=null,this.playerID_1=null,this.playerID_2=null,this.playerID_3=null}start(){this.solfeggioSynth.start()}setFrequency(t){this.solfeggioSynth.setFrequency(t)}playIntroTone(t){this.solfeggioSynth.play(t)}play(t){console.log("PLAYERS: Play",t.name,"song"),this.stopAll(),this.bgLoopID=this.tone.getTransport().scheduleOnce((e=>{console.log("---\x3e PLAYERS: BG LOOP"),this.playBackgroundLoop(t)}),"+"+this.tone.Time("4n")),this.playerID_1=this.tone.getTransport().scheduleOnce((e=>{console.log("---\x3e PLAYERS: PLAYER 2"),this.playInstrument(t)}),"+"+this.tone.Time("6m")),this.playerID_2=this.tone.getTransport().scheduleOnce((e=>{console.log("---\x3e PLAYERS: PLAYER 3"),this.playInstrument(t)}),"+"+this.tone.Time("14m")),this.playerID_3=this.tone.getTransport().scheduleOnce((e=>{console.log("---\x3e PLAYERS: PLAYER 4"),this.playInstrument(t)}),"+"+this.tone.Time("20m"))}playBackgroundLoop(t){const e=t.getBackgroundLoop();e?this._playInstrument(e):console.warn("PLAYERS: No background loop found")}playInstrument(t){const e=t.getInstruments().filter((t=>!this.activeInstrumentNames.includes(t.name)));if(0===e.length)return void console.warn("Players: All available instruments are playing");const n=e[Math.floor(Math.random()*e.length)];this._playInstrument(n)}resetPlayer(t){for(const e of this.players)if(e.getInstrumentName()===t){console.log("PLAYERS: Player",e.id,"with instrumentName",t,"has been reset."),e.resetInstrument();const n=this.activeInstrumentNames.indexOf(t);n>-1&&this.activeInstrumentNames.splice(n,1),console.log("--- RMV PLAYLIST",t);break}}_playInstrument(t){this.activeInstrumentNames.push(t.name),console.log("+++ ADD PLAYLIST",this.activeInstrumentNames);const e=this._getAvailablePlayer();e?(console.log("Players: Play",t.name,"on player",e.id),e.playInstrument(t)):console.warn("Players: All note players are being used")}_getAvailablePlayer(){let t=null;for(const e of this.players)if(!e.getInstrumentName()){t=e;break}return t}stopAll(){console.log("PLAYERS: Stop all"),this.tone.getTransport().clear(this.bgLoopID),this.tone.getTransport().clear(this.playerID_1),this.tone.getTransport().clear(this.playerID_2),this.tone.getTransport().clear(this.playerID_3),this.bgLoopID=null,this.playerID_1=null,this.playerID_2=null,this.playerID_3=null,this.players.forEach((t=>t.stop())),this.activeInstrumentNames=[]}}var y=n(306);class _{constructor(t){this.playComplete=(t,e)=>{console.log("AUDIO: Instrument",t,"complete, play next"),this.players.resetPlayer(t),this.players.playInstrument(this.currSong)},console.log("AUDIO: Init Audio Engine"),this.tone=t,this.songs=[],this.currSong=null,this.mainBusInput=null,this.mainBus=null,this.players=null,this.startSongID=null,this.initComplete=!1}async initAudioEngine(){console.log("AUDIO: Init Audio Engine with Tone",this.tone),this.initComplete||("suspended"===this.tone.getContext().state&&await this.tone.getContext().resume(),console.log("AUDIO: Tone resumed",this.tone.getContext().state),this.tone.getTransport().bpm.value=100,this.tone.getContext().lookAhead=1,console.log("AUDIO: Lookahead time",this.tone.getContext().lookAhead),"started"!==this.tone.getTransport().state?(console.log("AUDIO: Start transport"),this.tone.getTransport().start()):console.log("AUDIO: Transport already started"),this.songs=[new a(this.tone,1),new l(this.tone,1),new h(this.tone,2),new r(this.tone,3),new p(this.tone,4),new c(this.tone,5)],this.mainBusInput=new this.tone.Gain(1),this.mainBus=new s(this.tone,this.mainBusInput),this.players=new g(this.tone,this.mainBusInput,this.playComplete),this.initComplete=!0)}async playSong(t){await this.initAudioEngine(),console.log("AUDIO: Load song",t);const e=this.songs[t];if(!e)return void console.error("AUDIO: No song found for ID",t);if(this.currSong&&this.currSong.id===t)return void console.warn("AUDIO: Song already playing",this.currSong.name);this.currSong=e,console.log("AUDIO: Play intro tone",t),this.players.playIntroTone(t);await this.currSong.load()?console.log("AUDIO: Song",t,"loaded"):console.error("AUDIO: Failed to load song",t),this.players.setFrequency(y.A[t]),this.players.start(),this.startSongID=this.tone.getTransport().scheduleOnce((e=>{console.log("AUDIO: Play Song",t,"at time",e),this.players.play(this.currSong)}),"+"+this.tone.Time("4n"))}stopSong(){this.tone.getTransport().clear(this.startSongID),this.startSongID=null,this.players.stopAll()}_sleep(t){return new Promise((e=>setTimeout(e,t)))}}}}]);
//# sourceMappingURL=243.e2339d3b.chunk.js.map